#!/usr/bin/env ruby

require "date"

DURATION = Date.today.wday == 1 ? 3 : 1
DATE     = Time.at(Time.now.to_i - (86400 * DURATION)).to_date.freeze
USERNAME = `git config --get user.name`.strip.freeze

branches = `git branch`.split("\n").map { |line| line.split(" ").last }
branches.map do |branch|
  `git log #{branch} --format="%ad %s" --date=short --author="#{USERNAME}" --since="#{DURATION} days ago"`
    .split("\n")
    .each.with_index do |log, index|
      date, message = log.split(" ", 2)
      date = Date.parse(date)

      next if branch != "master" && date < DATE

      if index == 0
        puts "\n"
        puts "  \033[1;32;9m#{branch}\033[0m"
      end

      puts "    * #{message}"
    end
end

puts "\n"
