#!/usr/bin/env ruby

require "date"

DURATION = Date.today.wday == 1 ? 3 : 1
USERNAME = `git config --get user.name`.strip.freeze

`git for-each-ref --sort=-committerdate refs/heads/`
  .split("\n")
  .reverse
  .map do |line|
    line.split("/").last
  end
  .map do |branch|
    `git log #{branch} --format="%s" --author="#{USERNAME}" --since="#{DURATION} days ago"`
      .split("\n")
      .each.with_index do |log, index|
        if index == 0
          puts "\n"
          puts "  \033[1;32;9m#{branch}\033[0m"
        end

        puts "    * #{log}"
      end
  end

puts "\n"
